#! clean build -dtOg 0 -p @,test_* -x mpi run

name: phare
self: simulator pyphare
scm: https://github.com/dekken/phare
version: pydiag_plus_sim

profile:
- name: init
  inc: src subprojects
  src: src/initializer/(.*_provider.*).cpp
  dep: lang.pybind11 mkn.kul
  mod: lang.python3
  out: phare_initializer

- name: core
  self: init
  src: src/core
  out: phare_core

- name: samrai
  self: core
  src: src/amr
  dep: llnl.samrai(https://github.com/dekken/llnl.samrai)
  out: phare_amr

- name: solver
  self: samrai
  src: src/solver
  out: phare_solver

- name: pyphare
  self: init
  src: src/initializer/pyphare.cpp
  out: pyphare
  install: build/phare
  mod: lang.python3 lang.pybind11

- name: diagnostic
  self: solver
  dep: hpc.highfive(https://github.com/dekken/hpc.highfive)
  inc: /usr/include/hdf5/mpich
  out: phare_diagnostic
  lib: hdf5_mpich

- name: simulator
  self: diagnostic
  src: src/simulator
  out: phare_simulator
  mod: lang.python3

- name: exe
  self: simulator
  main: src/phare/phare.cpp
  mod: lang.python3
  env: PYTHONPATH=${MKN_ROOT}/build/tests/diagnostic:${MKN_ROOT}/build

- name: test
  inc: .
  self: diagnostic
  dep: google.test
  link: -pthread
  mod: lang.python3

- name: test_messengers
  parent: test
  main: tests/amr/messengers/test_messengers.cpp
  env: PYTHONPATH=${MKN_ROOT}/build/tests/amr/messengers:${MKN_ROOT}/build

- name: test_periodicity
  parent: test
  main: tests/amr/periodicity/test_main.cpp
  env: PYTHONPATH=${MKN_ROOT}/build/tests/amr/periodicity:${MKN_ROOT}/build

- name: test_diagnostics
  parent: test
  main: tests/diagnostic/test_main.cpp
  env: PYTHONPATH=${MKN_ROOT}/build/tests/diagnostic:${MKN_ROOT}/build

- name: test_simulator
  parent: test
  main: tests/simulator/initialize.cpp
  env: PYTHONPATH=${MKN_ROOT}/build/tests/simulator:${MKN_ROOT}/build
